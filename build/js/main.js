var zHeater={};zHeater.Core=function t(n,e){var i=n("Sandbox"),o=n("EventManager"),r=function(t,n){return function(){return t.apply(n,arguments)}},t={descriptor:{},sandboxes:{},init:function(t){return t=t||{},this.descriptor=t.descriptor||n("descriptor"),this.descriptor.modules=this.descriptor.modules||[],this.descriptor.layout=this.descriptor.layout||{},this.descriptors=t.descriptors||n("descriptors"),this._initModules(),this},_initModules:function(){for(var t=0,n=this.descriptor.modules.length;n>t;t++)this.initModule(this.descriptor.modules[t])},initModule:function(t){if(this.sandboxes[t])return this;var e=new i(this.descriptors[t]),o=n(t);return this.sandboxes[t]=e,new o(e),this},destroyModule:function(t){var n=this.sandboxes[t];if(n){o.trigger("destroy",null,n.namespace),o.unbindAllNs(n.namespace);var e=this.getBox(t);e&&(e.innerHTML=""),delete this.sandboxes[t]}return this},getBox:function(t){var n=this.descriptor.layout[t];return n?document.getElementById(n):null},dom:{getById:function(t){return t?document.getElementById(t):null},on:function(t,n,e){e&&t.addEventListener(n,e,!0)}},event:{stop:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}}},s={trigger:r(o.trigger,o),bind:r(o.bind,o),unbind:r(o.bind,o),unbindAllNs:r(o.unbindAllNs,o),init:r(t.init,t),destroyModule:r(t.destroyModule,t),initModule:r(t.initModule,t),getBox:r(t.getBox,t)};s.dom=t.dom,s.event=t.event;for(var u in s)s.hasOwnProperty(u)&&(e[u]=s[u])},zHeater.EventManager=function(t){return{eventsNs:{},_getEventListNs:function(t,n){var e=this;return e.eventsNs[t]||(e.eventsNs[t]={}),n?(e.eventsNs[t][n]||(e.eventsNs[t][n]=[]),e.eventsNs[t][n]):e.eventsNs[t]},_parseEventsString:function(t){for(var n=t.split(" "),e=[],i=0,o=n.length;o>i;i++)n[i]&&e.push(n[i]);return e},trigger:function(t,n,e){if("string"==typeof t){t=this._parseEventsString(t);for(var i,o,r,s=0,u=t.length;u>s;s++){r=t[s],i=this._getEventListNs(r);for(var a in i)if((!e||e===a)&&i.hasOwnProperty(a)){o=i[a];for(var d,c=0,h=o.length;h>c;c++)d={type:[t[s]],data:n},o[c](d)}}}return this},bind:function(t,n,e){if("string"==typeof t&&"function"==typeof n){e=e||"*",t=this._parseEventsString(t);for(var i=0,o=t.length;o>i;i++)this._getEventListNs(t[i],e).push(n)}return this},unbind:function(t,n,e){if("string"==typeof t){"string"==typeof n&&"undefined"==typeof e&&(e=n,n=void 0),e=e||"*",t=this._parseEventsString(t);for(var i,o,r=0,s=t.length;s>r;r++)i=this._getEventListNs(t[r],e),n?(o=i.indexOf(n),-1!==o&&i.splice(o,1)):i.splice(0)}return this},unbindAllNs:function(t){var n;for(var e in this.eventsNs)this.eventsNs.hasOwnProperty(e)&&(n=this.eventsNs[e],n[t]&&(n[t]=[]));return this}}},zHeater.Sandbox=function(t){var n=t("Core"),e=t("EventManager"),i=0,o=function(t){this.descriptor=t||{},this.namespace=this.descriptor.name+""+ ++i};return o.prototype.getBox=function(){return n.getBox(this.descriptor.name)},o.prototype.bind=function(t,n){return e.bind(t,n,this.namespace),this},o.prototype.unbind=function(t,n){return e.unbind(t,n,this.namespace),this},o.prototype.trigger=function(t,n){return e.trigger(t,n),this},o.prototype.getResource=function(t){return this.descriptor.resources[t]},o.prototype.dom={},o.prototype.dom.getById=function(t){return n.dom.getById(t)},o.prototype.dom.on=function(t,e,i){n.dom.on(t,e,i)},o.prototype.event={},o.prototype.event.stop=function(t){n.event.stop(t)},o},zHeater.descriptor={modules:["Common","Form","Calculator","Printer","Helper"],layout:{Form:"form",Printer:"printer",Helper:"helper"}},zHeater.descriptors={Common:{name:"Common"},Form:{name:"Form",resources:{inputs:{diameter:"D",height:"H",gap:"gap",thickness:"Tk"}}},Calculator:{name:"Calculator"},Printer:{name:"Printer",resources:{table:"table",printer_left:"printer_left",printer_link:"printer_link"}},Helper:{name:"Helper"}},zHeater.Common=function(t,n,e){var i=function(t){var n=this;this.sandbox=t,this.box=document.body,this.sandbox.dom.on(this.box,"keyup",function(t){var e=t.which;switch(e){case n.KEYS.ESC:n.sandbox.trigger("common:keyup:esc");break;case n.KEYS.ENTER:return console.log("ENTER pressed"),t.preventDefault(),!1}})};return i.prototype.KEYS={ESC:27,ENTER:13},i},zHeater.Calculator=function n(t,e,i){function o(t){return t+150}function r(t){return 80*t}function s(t){return(.5*t)._z_roundTo(2)}function u(t){return(10*Math.sqrt(4*t/Math.PI))._z_roundTo(2)}function a(t){return(1.75*t)._z_roundTo(2)}function d(t,n){return(t*n)._z_roundTo(2)}function c(t,n){return(t*n)._z_roundTo(2)}function h(t,n){return t/=100,n/=100,(Math.PI*t*t*n/4)._z_roundTo(2)}function p(t){return(2*t/3)._z_roundTo(2)}function f(){return.403}function l(){return 5.59}function g(t){return(.05*t)._z_roundTo(2)}function b(t){return 300>t?40:t>=300&&400>t?40:t>=400&&600>t?50:t>=600&&800>t?60:t>=800?80:void 0}function m(t){return 300>t?8:t>=300&&400>t?8:t>=400&&600>t?6:t>=600&&800>t?4:t>=800?2.5:void 0}function v(t,n){return(t+n+20)._z_roundTo(2)}function y(t,n,e){return(t+n+e+30)._z_roundTo(2)}function x(t,n,e){return(t-n-e)._z_roundTo(2)}function k(t,n){return(t+n+100)._z_roundTo(2)}Number.prototype._z_roundTo=function(t){return t=parseInt(t),isNaN(t)?this:(t=Math.pow(10,t),Math.round(this*t)/t)};var n=function(t,n){var e=this;this.sandbox=t,n=n||{},this.D=n.D||0,this.H=n.H||0,this.Tk=n.Tk||0,this.gap=n.gap||0,this.sandbox.bind("form:ready",function(t){e.setup(t.data.d,t.data.h,t.data.g,t.data.tk),e.calculate()})},_=n.prototype;return _.calculate=function(){var t={};return t.D=this.D,t.H=this.H,t.Tk=this.Tk,t.gap=this.gap,t.C=g(this.D),t.Tb=m(this.D),t.h=b(this.D),t.Hf=p(this.H),t.Vf=h(this.D,t.Hf),t.M=c(t.Vf,f()),t.E=d(t.M,l()),t.S=a(t.E),t.Dout=u(t.S),t.d=s(t.Dout),t.L=r(this.gap),t.q=o(t.L),t.i=v(t.h,t.Tb),t.Hm=y(t.Hf,t.h,t.Tb),t.hm=x(t.H,t.Hm,t.i),t.ha=k(t.h,t.Tb),this.sandbox.trigger("calculate:ready",t),t},_.setup=function(t,n,e,i){this.D=t||this.D,this.H=n||this.H,this.gap=e||this.gap,this.Tk=i||this.Tk},n},zHeater.Form=function(t,n,e){function i(t){var n=this;this.sandbox=t,this.formElem=t.getBox(),this.inputs={};var e=this.sandbox.getResource("inputs");this.inputs.diameter=t.dom.getById(e.diameter),this.inputs.height=t.dom.getById(e.height),this.inputs.gap=t.dom.getById(e.gap),this.inputs.thickness=t.dom.getById(e.thickness),t.dom.on(this.inputs.diameter,"input",function(t){n.inputs.diameter.value=n.correctInput(n.inputs.diameter.value,"int"),n.checkInput(n.inputs.diameter.value,"int")&&n.restore("diameter")}),t.dom.on(this.inputs.height,"input",function(t){n.inputs.height.value=n.correctInput(n.inputs.height.value,"int"),n.checkInput(n.inputs.height.value,"int")&&n.restore("height")}),t.dom.on(this.inputs.gap,"input",function(t){n.inputs.gap.value=n.correctInput(n.inputs.gap.value,"float"),n.checkInput(n.inputs.gap.value,"float")&&n.restore("gap")}),t.dom.on(this.inputs.thickness,"input",function(t){n.inputs.thickness.value=n.correctInput(n.inputs.thickness.value,"float"),n.checkInput(n.inputs.thickness.value,"float")&&n.restore("thickness")}),t.dom.on(this.inputs.diameter,"focus",function(t){n.sandbox.trigger("form:focus-d")}),t.dom.on(this.inputs.height,"focus",function(t){n.sandbox.trigger("form:focus-h")}),t.dom.on(this.inputs.gap,"focus",function(t){n.sandbox.trigger("form:focus-g")}),t.dom.on(this.inputs.thickness,"focus",function(t){n.sandbox.trigger("form:focus-tk")}),t.bind("helper:loaded",function(){n.inputs.diameter.focus(),n.sandbox.trigger("form:focus-d")}),t.dom.on(this.formElem,"submit",function(e){try{var i=parseInt(n.inputs.diameter.value),o=parseInt(n.inputs.height.value),r=parseFloat(n.inputs.gap.value),s=parseFloat(n.inputs.thickness.value);n.validate(i,o,r,s)?n.sandbox.trigger("form:ready",{d:i,h:o,g:r,tk:s}):n.checkInput(n.inputs.diameter.value,"int")||n.highlightInput("diameter"),n.checkInput(n.inputs.height.value,"int")||n.highlightInput("height"),n.checkInput(n.inputs.gap.value,"float")||n.highlightInput("gap"),n.checkInput(n.inputs.thickness.value,"float")||n.highlightInput("thickness"),n.sandbox.trigger("form:validateError")}catch(u){console.log("try/catch"),console.error(u),n.sandbox.trigger("form:error",u)}t.event.stop(e)})}return i.prototype.validate=function(t,n,e,i){return!(isNaN(t)||isNaN(n)||isNaN(e)||isNaN(i))},i.prototype.correctInput=function(t,n){switch(n){case"int":return t.replace(/[^0-9]/g,"");case"float":return t=t.replace(",","."),t.replace(/[^0-9\.]/g,"");default:return t}},i.prototype.checkInput=function(t,n){switch(n){case"int":return/^[0-9]+$/.test(t);case"float":return/^[0-9]+(\.([0-9])*)?$/.test(t);default:return null}},i.prototype.highlightInput=function(t){t&&this.inputs[t]&&(this.inputs[t].style.borderColor="#e74c3c")},i.prototype.restore=function(t){if(t)this.inputs[t]&&(this.inputs[t].style.borderColor="");else for(var n in this.inputs)this.inputs[n].style.borderColor=""},i},zHeater.Printer=function(t){function n(t){var n=this;this.sandbox=t,this.box=this.sandbox.getBox(),this.table=this.sandbox.dom.getById(this.sandbox.getResource("table")),this.link=this.sandbox.dom.getById(this.sandbox.getResource("printer_link")),this.tBody=this.table.tBodies[0],this.wrapImageElement=this.sandbox.dom.getById(this.sandbox.getResource("printer_left")),this.sandbox.dom.on(this.link,"click",function(t){n.sandbox.event.stop(t),n.hide(),n.sandbox.trigger("printer:hidden")}),n.sandbox.bind("common:keyup:esc",function(t){n.isShown()&&n.hide()}),this.sandbox.bind("calculate:ready",function(t){n.box.getAttribute("tabindex")||n.box.setAttribute("tabindex","-1"),document.body.style.overflow="hidden";var e="";n.result=t.data;for(var i in t.data)t.data.hasOwnProperty(i)&&(e+="<tr><td>"+i+"</td><td>"+t.data[i]+"</td></tr>");n.tBody.innerHTML=e,n.show(),n.box.focus()})}return n.prototype.hide=function(){this.box.style.display="none",document.body.style.overflow=""},n.prototype.show=function(){this.box.style.display="block"},n.prototype.isShown=function(){return"block"===this.box.style.display},n},zHeater.Helper=function(t){function n(t){var n=this;this.sandbox=t,this.box=this.sandbox.getBox(),this.sandbox.bind("form:focus-d",function(){n.box.style.backgroundPosition="-350px 0",n.box.style.backgroundSize=""}),this.sandbox.bind("form:focus-h",function(){n.box.style.backgroundPosition="-100px -85px",n.box.style.backgroundSize="384px"}),this.sandbox.bind("form:focus-g",function(){n.box.style.backgroundPosition="-350px -150px",n.box.style.backgroundSize=""}),this.sandbox.bind("form:focus-tk",function(){n.box.style.backgroundPosition="-250px -650px",n.box.style.backgroundSize=""}),this.sandbox.trigger("helper:loaded",null)}return n},function(t,n){var e={},i={},o=function(r){var s,u=e[r];return i[r]&&u?u:(s={exports:{}},i[r]=1,e[r]=s.exports,u?"function"==typeof u&&(u=u(n[r]?null:o,s.exports,s)||s.exports):u=t[r],e[r]=u)},r=function(t){var n={exports:{}};switch(typeof t){case"function":t(o,n.exports,n);break;case"object":for(var s in t)i[s]=0,e[s]=t[s]}return r};return r}(window,{moduleName:!0})(zHeater)(function(t,n,e){t("Core").init()});